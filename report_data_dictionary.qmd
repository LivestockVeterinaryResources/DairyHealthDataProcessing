---
title: "Data Dictionary"
format: html
execute:
  echo: false
  warning: false
  message: false
embed-resources: true
---


```{r}
library(tidyverse)
library(arrow)
```


```{r file list}
master_sk<-NULL

list_intermediate_files<-list.files('data/intermediate_files')

fxn_graph_file_skim <- function(file_name) {
  df <- read_parquet(file.path('data/intermediate_files', file_name))
  sk_df <- skimr::skim(df) %>%
    mutate(parquet_file_name = file_name) %>%
    arrange(skim_variable)
  
  ggplot(sk_df) +
    geom_bar(aes(x = skim_variable, y = complete_rate, fill = skim_type), stat = 'identity') +
    facet_wrap(~parquet_file_name) +
    coord_flip() +
    theme_bw() +
    scale_fill_viridis_d()
}

```


This report contains a list of variable names for the files in that are created after the data is processed. Most are self explanatory.  Location of the files are in data/intermediate_files/ folder.
In all tables the variable that starts with location indicates the farm/site of the event or calculation.

## Animals

This file lists each animal as a row. id_animal is the unique identifier of each animal. There should be one unique date for each date in this table, but sometimes there is not. Thus there are date_XXX_max variables.
```{r animals}

fxn_graph_file_skim("animals.parquet")

              
```

## Animal Lactations

This file lists each animal lactation as a row. id_animal_lact is the unique identifier of each animal lactation. There should be one unique date for each date in this table, but sometimes there is not. Thus there are date_XXX_max variables.
```{r animal lact}

fxn_graph_file_skim("animal_lactations.parquet")
              
```

## Events Formatted

This is the main fundamental file driving the values in all other files. This file was created using the EVENTS\2S2000C #1 #2 #4 #5 #6 #11 #12 #13 #15 #28 #29 #30 #31 #32 #38 #40 #43 command in Dairy Comp 305.

Each row is an "event" which specifies the animal, phase (lactation), date, and description (event, remark, protoocls etc.) of what happened to that animal on that day. Usually the disease and treatment information is found by custom parsing this information.

The events_formated files drops the original column names and uses standard ones which have been formatted.  If there is a problem with the formatting the events_all_columns file can be used to chase any issues.  

```{r}
fxn_graph_file_skim("events_formatted.parquet") 

```

## Events parsed

This file is a further processed file from events_formatted where disease and treatment information has been parsed out into separate columns.

```{r, fig.height=12}

fxn_graph_file_skim("events_parsed.parquet")

```

# Denominators (in Development) 

This is in active development and not yet finalized. Currently there are 3 denominator files that give denominator values for the past year.  The are overall, by DIM and by month. We plan to give you more customized options in the future.

## Herd Denominators

``` {r}
#| fig.height: 3

fxn_graph_file_skim("herd_denominators.parquet") 

```

## Herd DIM Denominators

Inventory for past year in 13 30 DIM windows for

``` {r}
#| fig.height: 3

fxn_graph_file_skim("herd_dim_denominators.parquet") 

```

## Herd Denominators by month

Monthly inventory for the past year

``` {r}
#| fig.height: 3

fxn_graph_file_skim("herd_season_denominators.parquet") 

```


## Standard Denominators

### Calendar Time

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_calendar_time.parquet") 

```

### Time Period

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_time_period.parquet") 

```

### Phase Time

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_phase_time.parquet") 

```

## Custom Variable Denominator Template (breed_simple)

### Calendar Time (custom variable "breed_simple")

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_calendar_time_custom_breed.parquet") 

```

### Time Period (custom variable "breed_simple")

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_time_period_custom_breed.parquet") 

```

### Phase Time (custom variable "breed_simple")

``` {r}
#| fig.height: 3

fxn_graph_file_skim("denominator_phase_time_custom_breed.parquet") 

```
